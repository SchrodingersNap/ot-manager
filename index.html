This is **Version 8**. I have updated the code to strictly follow your new sorting and ranking rules.

### üåü Key Changes in V8:

1. **Unified Sorting:** Absentees (`A`) and Duty Swap Originals (`DC`) are **no longer moved to the bottom**. They stay exactly where they belong in the list based on their hours.
2. **New Numbering:** Changed from "D1, D2" to simple **"1, 2, 3..."**.
3. **Smart Ranking:** The numbers (1, 2, 3) **skip** the Absentees and DC staff.
* *Example:* If the top person is Absent, they show "A". The next person gets rank "1".


4. **Replacer Options:** Added a **"Refuse"** button for the Replacer (Duty Swap Worker) so they can also refuse OT.

### ‚úàÔ∏è IOCL OT Manager (V8: Unified Sequence)

Save this as `index.html`.

```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IOCL OT Manager (V8 Unified)</title>
    <style>
        :root { --primary: #0056b3; --bg: #f4f7f6; --text: #333; --card: #fff; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: var(--text); padding: 15px; max-width: 900px; margin: 0 auto; }
        
        /* Header */
        header { text-align: center; margin-bottom: 20px; }
        h1 { margin: 0; color: var(--primary); }
        .subtitle { color: #666; font-size: 0.9em; }

        /* Tabs */
        .tabs { display: flex; gap: 10px; margin-bottom: 15px; overflow-x: auto; }
        .tab-btn { padding: 10px 20px; border: none; background: #e0e0e0; border-radius: 20px; cursor: pointer; font-weight: 600; white-space: nowrap; }
        .tab-btn.active { background: var(--primary); color: white; }

        /* Content Cards */
        .card { background: var(--card); padding: 20px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); margin-bottom: 20px; display: none; }
        .card.active { display: block; }
        
        /* Layouts */
        .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        
        /* Inputs */
        label { display: block; font-size: 0.85em; font-weight: bold; margin-bottom: 5px; color: #555; }
        input, select, textarea { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; font-size: 1em; }
        textarea { height: 100px; font-family: monospace; }
        
        /* Buttons */
        button { width: 100%; padding: 14px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; margin-top: 10px; font-size: 1em; transition: 0.2s; }
        .btn-primary { background: var(--primary); color: white; }
        .btn-sec { background: #6c757d; color: white; }
        .btn-danger { background: #dc3545; color: white; }
        .btn-sm { width: auto; padding: 6px 12px; font-size: 0.85em; margin: 0; }

        /* Tables */
        table { width: 100%; border-collapse: collapse; margin-top: 10px; font-size: 0.9em; }
        th { text-align: left; padding: 10px; background: #f8f9fa; color: #666; border-bottom: 2px solid #ddd; }
        td { padding: 10px; border-bottom: 1px solid #eee; vertical-align: middle; }
        
        /* Row Styles */
        .row-absent { background-color: #ffebee; color: #b71c1c; opacity: 0.8; }
        .row-dc { background-color: #fff3e0; color: #e65100; opacity: 0.8; }
        .row-extra { background-color: #e8f5e9; border-left: 5px solid #4caf50; }

        /* Status Text */
        .status-A { color: red; font-weight: 900; font-size: 1.2em; }
        .status-DC { color: #e65100; font-weight: 900; font-size: 1.1em; }
        .status-Rank { color: #0056b3; font-weight: bold; font-size: 1.1em; }

        /* Notifications */
        #statusMsg { position: fixed; bottom: 20px; right: 20px; background: #333; color: white; padding: 12px 20px; border-radius: 8px; display: none; z-index: 100; }
    </style>
</head>
<body>

    <header>
        <h1>‚úàÔ∏è IOCL OT Manager V8</h1>
        <div class="subtitle">Unified Sorting | Smart Ranking (1, 2, 3...)</div>
    </header>

    <div class="tabs">
        <button class="tab-btn active" onclick="showTab('daily')">Daily Operation</button>
        <button class="tab-btn" onclick="showTab('setup')">Month Start</button>
        <button class="tab-btn" onclick="showTab('roster')">Database</button>
    </div>

    <div id="daily" class="card active">
        <div class="grid-2">
            <div>
                <label>Duty Groups (e.g. 1 7)</label>
                <input type="text" id="dutyInput" placeholder="Enter group numbers">
            </div>
            <div>
                <label>Select Shift</label>
                <select id="shiftInput">
                    <option value="A">Shift A (+6 hrs)</option>
                    <option value="B">Shift B (+8 hrs)</option>
                    <option value="C">Shift C (+10 hrs)</option>
                </select>
            </div>
        </div>
        
        <div class="grid-2" style="margin-top: 15px;">
            <div>
                <label>Absentees</label>
                <input type="text" id="absentInput" placeholder="Search name...">
            </div>
            <div>
                <label>Duty Swap: [Worker] for [Original]</label>
                <div style="display:flex; gap:5px;">
                    <input type="text" id="swapReplacer" placeholder="Worker (Replacer)">
                    <input type="text" id="swapOriginal" placeholder="Original (Off)">
                </div>
            </div>
        </div>

        <button class="btn-primary" onclick="generateList()">üîÑ Generate Priority List</button>

        <div id="resultSection" style="display:none; margin-top:20px; border-top:2px solid #eee; padding-top:10px;">
            
            <h3 style="margin:0 0 10px 0;">Priority Sequence</h3>
            <table>
                <thead>
                    <tr>
                        <th style="width:50px">Rank</th>
                        <th>Name</th>
                        <th>Grp</th>
                        <th>Hrs</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody id="mainListBody"></tbody>
            </table>

            <h4 style="margin: 20px 0 10px 0; color: #2e7d32;">‚¨áÔ∏è Duty Swap / Replacers</h4>
            <table>
                <thead>
                    <tr>
                        <th style="width:50px">Type</th>
                        <th>Name</th>
                        <th>Grp</th>
                        <th>Hrs</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody id="extraListBody"></tbody>
            </table>

        </div>
    </div>

    <div id="setup" class="card">
        <h3>1. New Month Setup</h3>
        <p style="color:#666; font-size:0.9em;">Paste Excel data to set sequence and reset hours to zero.</p>
        <textarea id="excelInput" placeholder="Paste Excel data here..."></textarea>
        <button class="btn-sec" onclick="processExcel()">Set Sequence & Reset</button>
        <div id="unmatchedList" style="margin-top:10px; color:red;"></div>
        <button class="btn-danger" onclick="hardReset()" style="margin-top: 30px;">‚ö†Ô∏è Factory Reset</button>
    </div>

    <div id="roster" class="card">
        <h3>Staff Database</h3>
        <input type="text" id="dbSearch" placeholder="Search..." onkeyup="renderDB()">
        <table>
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Grp</th>
                    <th>Hrs</th>
                    <th>Rank</th>
                </tr>
            </thead>
            <tbody id="dbBody"></tbody>
        </table>
    </div>

    <div id="statusMsg"></div>

<script>
    const HOURS = { 'A': 6, 'B': 8, 'C': 10 };
    
    const defaultRoster = [
        { name: "Bidhan Deb Barma", group: 1 }, { name: "Sanjay Paul", group: 1 },
        { name: "Gourab Biswas", group: 1 }, { name: "Pardeep .", group: 1 },
        { name: "Mrityunjoy Saha", group: 1 }, { name: "Pradip Kumar Mondal", group: 1 },
        { name: "Pramod Kumar Meena", group: 1 }, { name: "Sunit Kumar Das", group: 1 },
        { name: "Pankaj Chowdhury", group: 2 }, { name: "PARTHA ROY", group: 2 },
        { name: "Mukesh Swami", group: 2 }, { name: "Joydeb Mandal", group: 2 },
        { name: "Abhisake Chandan Tirkey", group: 2 }, { name: "Kingsuk Burman", group: 2 },
        { name: "Shibendu Dutta", group: 2 }, { name: "Rajib Kumar Paul", group: 2 },
        { name: "Rajendra Kumar", group: 3 }, { name: "Amit Kumar", group: 3 },
        { name: "VARASALA AMBEDKAR", group: 3 }, { name: "Vikas Chhikara", group: 3 },
        { name: "DIPANKAR DEY", group: 3 }, { name: "Sanjib Kumar Mondal", group: 3 },
        { name: "Sukumar Maji", group: 3 }, { name: "Alok Roy", group: 3 },
        { name: "Pradip Karmakar", group: 3 },
        { name: "Mohit", group: 4 }, { name: "Jitender .", group: 4 },
        { name: "Subhra Jyoti Banerjee", group: 4 }, { name: "Tej Singh Meena", group: 4 },
        { name: "Sarbeswar Hembram", group: 4 }, { name: "RAJIB SEN", group: 4 },
        { name: "Gopal Howli", group: 4 }, { name: "Kalyan Mondal", group: 4 },
        { name: "Chandra Nath Mitra", group: 5 }, { name: "Sudhir .", group: 5 },
        { name: "Manjeet .", group: 5 }, { name: "Somenath Mandal", group: 5 },
        { name: "BISWARUP CHAKRABORTY", group: 5 }, { name: "Ashok Dasgupta", group: 5 },
        { name: "Sanjay Dey", group: 5 }, { name: "Sanjit Mondal", group: 5 },
        { name: "Subhajit Saha", group: 6 }, { name: "Soumen Mondal", group: 6 },
        { name: "Naveen .", group: 6 }, { name: "Shyamal Kumar Ghosh", group: 6 },
        { name: "Dhirendar Kumar", group: 6 }, { name: "Soumalaya", group: 6 },
        { name: "Azam Ali", group: 7 }, { name: "Nitin Kumar", group: 7 },
        { name: "Anil Kumar", group: 7 }, { name: "Goutam Patra", group: 7 },
        { name: "PALLAB KR. SAHA", group: 7 }, { name: "SK. SABIR AHMED", group: 7 },
        { name: "SOMENATH DAS", group: 7 }, { name: "Hemlal Sharma", group: 7 }
    ];

    let roster = [];

    window.onload = () => {
        // Use v8 key to force fresh load with correct logic
        const saved = localStorage.getItem('iocl_v8_data');
        if (saved) {
            roster = JSON.parse(saved);
        } else {
            roster = defaultRoster.map((p, i) => ({ ...p, current: 0, baseRank: i }));
            save();
        }
        renderDB();
    };

    function save() {
        localStorage.setItem('iocl_v8_data', JSON.stringify(roster));
        renderDB();
    }

    // === GENERATION LOGIC ===
    function generateList() {
        const groups = document.getElementById('dutyInput').value.split(/[\s,]+/).map(Number).filter(n => n > 0);
        const shift = document.getElementById('shiftInput').value;
        const absentees = document.getElementById('absentInput').value.toLowerCase().split(',').filter(s => s.trim());
        const repName = document.getElementById('swapReplacer').value;
        const orgName = document.getElementById('swapOriginal').value;

        // 1. Identify Special Cases
        let absentIdx = [];
        absentees.forEach(a => {
            const p = findPerson(a);
            if(p) absentIdx.push(p.index);
        });

        let originalIdx = -1;
        if (orgName) {
            const org = findPerson(orgName);
            if (org) originalIdx = org.index;
        }

        let replacerIdx = -1;
        if (repName) {
            const rep = findPerson(repName);
            if (rep) replacerIdx = rep.index;
        }

        // 2. Build Single Main List (for sequence preservation)
        let mainList = [];
        let extraList = []; // Replacers

        // Add Replacer to Extra List
        if (replacerIdx !== -1) {
            extraList.push({ ...roster[replacerIdx], idx: replacerIdx });
        }

        // Iterate Roster
        roster.forEach((p, index) => {
            // Skip Replacer (already handled in extra list)
            if (index === replacerIdx) return;

            // Check if in Duty Group
            if (groups.includes(p.group)) {
                let status = 'Normal';
                
                // Case: Absent
                if (absentIdx.includes(index)) {
                    status = 'A';
                }
                // Case: Original in Swap (DC Out)
                else if (index === originalIdx) {
                    status = 'DC';
                }
                
                mainList.push({ ...p, idx: index, status: status });
            }
        });

        // 3. Unified Sorting (Hrs -> Base Rank)
        // This ensures A and DC stay "in sequence" based on their hours
        mainList.sort((a, b) => {
            if (a.current !== b.current) return a.current - b.current;
            return a.baseRank - b.baseRank;
        });

        renderTables(mainList, extraList, shift);
    }

    function renderTables(mainList, extraList, shift) {
        const mainBody = document.getElementById('mainListBody');
        const extraBody = document.getElementById('extraListBody');
        mainBody.innerHTML = '';
        extraBody.innerHTML = '';
        
        document.getElementById('resultSection').style.display = 'block';
        const add = HOURS[shift];

        // RENDER MAIN TABLE
        let rankCounter = 1;
        
        mainList.forEach(p => {
            const tr = document.createElement('tr');
            
            let rankHtml = '';
            let rowClass = '';

            // Assign numbers ONLY to Normal people
            if (p.status === 'A') {
                rankHtml = '<span class="status-A">A</span>';
                rowClass = 'row-absent';
            } else if (p.status === 'DC') {
                rankHtml = '<span class="status-DC">DC</span>';
                rowClass = 'row-dc';
            } else {
                rankHtml = `<span class="status-Rank">${rankCounter++}</span>`; // Simple 1, 2, 3
            }

            tr.className = rowClass;
            tr.innerHTML = `
                <td>${rankHtml}</td>
                <td>${p.name}</td>
                <td>${p.group}</td>
                <td>${p.current}</td>
                <td>
                    <button class="btn-primary btn-sm" onclick="update(${p.idx}, ${add}, false)">Work</button>
                    <button class="btn-danger btn-sm" onclick="update(${p.idx}, ${add}, true)">Refuse</button>
                </td>
            `;
            mainBody.appendChild(tr);
        });

        // RENDER EXTRA TABLE
        extraList.forEach(p => {
            const tr = document.createElement('tr');
            tr.className = 'row-extra';
            tr.innerHTML = `
                <td><span style="font-weight:bold; color:green;">SWAP</span></td>
                <td>${p.name}</td>
                <td>${p.group}</td>
                <td>${p.current}</td>
                <td>
                    <button class="btn-primary btn-sm" onclick="update(${p.idx}, ${add}, false)">Work</button>
                    <button class="btn-danger btn-sm" onclick="update(${p.idx}, ${add}, true)">Refuse</button>
                </td>
            `;
            extraBody.appendChild(tr);
        });

        if(extraList.length === 0) {
            extraBody.innerHTML = '<tr><td colspan="5" style="text-align:center; color:#999;">No duty swaps entered.</td></tr>';
        }
    }

    function update(index, amount, isRefusal) {
        if (!confirm(`Update ${roster[index].name} hours?`)) return;
        roster[index].current += amount;
        save();
        generateList();
        showMsg("Database Updated!");
    }

    function processExcel() {
        const lines = document.getElementById('excelInput').value.split('\n');
        let tempStats = roster.map((p, i) => ({ index: i, total: 0 }));
        let count = 0;
        let unmatched = [];

        lines.forEach(line => {
            const parts = line.split(/\t/);
            if (parts.length >= 2) {
                const name = parts[1].trim();
                const shiftChar = parts.length >= 5 ? parts[4].trim().toUpperCase() : '';
                if (HOURS[shiftChar]) {
                    const match = findPerson(name);
                    if (match) {
                        tempStats[match.index].total += HOURS[shiftChar];
                        count++;
                    } else {
                        unmatched.push(name);
                    }
                }
            }
        });

        tempStats.sort((a, b) => a.total - b.total);
        tempStats.forEach((item, newRank) => {
            roster[item.index].baseRank = newRank;
            roster[item.index].current = 0;
        });

        save();
        document.getElementById('unmatchedList').innerText = unmatched.length ? "Unmatched: " + unmatched.join(', ') : "";
        alert(`Reset Complete. ${count} records processed.`);
    }

    function hardReset() {
        if (confirm("DELETE ALL DATA?")) {
            localStorage.removeItem('iocl_v8_data');
            location.reload();
        }
    }

    function findPerson(query) {
        query = query.toLowerCase().trim().replace(/\s+/g, ' ');
        let idx = roster.findIndex(p => p.name.toLowerCase() === query);
        if (idx !== -1) return { index: idx, ...roster[idx] };
        if (query.length > 3) {
            idx = roster.findIndex(p => p.name.toLowerCase().includes(query));
            if (idx !== -1) return { index: idx, ...roster[idx] };
        }
        return null;
    }

    function showTab(id) {
        document.querySelectorAll('.card').forEach(c => c.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        event.target.classList.add('active');
    }

    function renderDB() {
        const tbody = document.getElementById('dbBody');
        tbody.innerHTML = '';
        const search = document.getElementById('dbSearch').value.toLowerCase();
        
        roster.forEach(p => {
            if (search && !p.name.toLowerCase().includes(search)) return;
            const tr = document.createElement('tr');
            tr.innerHTML = `<td>${p.name}</td><td>${p.group}</td><td>${p.current}</td><td>${p.baseRank}</td>`;
            tbody.appendChild(tr);
        });
    }

    function showMsg(txt) {
        const el = document.getElementById('statusMsg');
        el.innerText = txt;
        el.style.display = 'block';
        setTimeout(() => el.style.display = 'none', 3000);
    }
</script>
</body>
</html>

```
